#!/usr/bin/env python3
"""
Ø¨ÙˆØª Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¹Ù„Ù‰ ØªÙ„Ø¬Ø±Ø§Ù…
Customer Service Bot for Telegram
"""

import logging
import os
from datetime import datetime
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup, ChatAction
from telegram.ext import (
    Application,
    CommandHandler,
    MessageHandler,
    CallbackQueryHandler,
    ConversationHandler,
    filters,
    ContextTypes,
)

# Ø¥Ø¹Ø¯Ø§Ø¯ Ù†Ø¸Ø§Ù… Ø§Ù„Ø³Ø¬Ù„Ø§Øª
logging.basicConfig(
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    level=logging.INFO
)
logger = logging.getLogger(__name__)

# Token Ø§Ù„Ø¨ÙˆØª
BOT_TOKEN = "7968719347:AAEUloIBy_gvD2cmE9vrdiHcZwClldYZ-Xk"

# Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ (ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ±Ù‡ Ù„Ø§Ø­Ù‚Ø§Ù‹)
ADMIN_ID = None  # Ø³ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ†Ù‡ Ù…Ù† Ø£ÙˆÙ„ Ù…Ø³ØªØ®Ø¯Ù…

# Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
CHOOSING, TYPING_REPLY, WAITING_FOR_MESSAGE = range(3)

# Ù‚Ø§Ù…ÙˆØ³ Ù„ØªØ®Ø²ÙŠÙ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
user_data = {}


async def start(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
    """Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹ Ø§Ù„Ø¨ÙˆØª"""
    user = update.effective_user
    user_id = user.id
    
    # ØªØ³Ø¬ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    if user_id not in user_data:
        user_data[user_id] = {
            'name': user.first_name,
            'username': user.username,
            'start_time': datetime.now(),
            'messages': []
        }
    
    # Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨
    welcome_text = f"""
ğŸ‘‹ Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹ {user.first_name}!

Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø¨ÙˆØª Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡. Ù†Ø­Ù† Ù‡Ù†Ø§ Ù„Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ!

Ø§Ø®ØªØ± Ø£Ø­Ø¯ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©:
"""
    
    # Ø¥Ù†Ø´Ø§Ø¡ Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
    keyboard = [
        [InlineKeyboardButton("â“ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©", callback_data='faq')],
        [InlineKeyboardButton("ğŸ“ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù…", callback_data='support')],
        [InlineKeyboardButton("â„¹ï¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù†Ø§", callback_data='about')],
        [InlineKeyboardButton("ğŸ’¬ Ø´ÙƒÙˆÙ‰ Ø£Ùˆ Ø§Ù‚ØªØ±Ø§Ø­", callback_data='complaint')],
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    await update.message.reply_text(welcome_text, reply_markup=reply_markup)
    return CHOOSING


async def button_callback(update: Update, context: ContextTypes.DEFAULT_TYPE) -> int:
    """Ù…Ø¹Ø§Ù„Ø¬Ø© Ù†Ù‚Ø±Ø§Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø±"""
    query = update.callback_query
    await query.answer()
    
    choice = query.data
    user_id = query.from_user.id
    
    if choice == 'faq':
        await handle_faq(query)
    elif choice == 'support':
        await handle_support(query, context)
    elif choice == 'about':
        await handle_about(query)
    elif choice == 'complaint':
        await handle_complaint(query, context)
    elif choice == 'back_to_menu':
        await back_to_menu(query)
    
    return CHOOSING


async def handle_faq(query) -> None:
    """Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©"""
    faq_text = """
â“ **Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©**

**Ø³: ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨ÙØ±ÙŠÙ‚ Ø§Ù„Ø¯Ø¹Ù…ØŸ**
Ø¬: ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± "Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù…" Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©.

**Ø³: Ù…Ø§ Ù‡ÙŠ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ØŸ**
Ø¬: Ù†Ø­Ù† Ù…ØªØ§Ø­ÙˆÙ† Ù…Ù† Ø§Ù„Ø³Ø§Ø¹Ø© 9 ØµØ¨Ø§Ø­Ø§Ù‹ Ø¥Ù„Ù‰ 6 Ù…Ø³Ø§Ø¡Ù‹ØŒ Ù…Ù† Ø§Ù„Ø£Ø­Ø¯ Ø¥Ù„Ù‰ Ø§Ù„Ø®Ù…ÙŠØ³.

**Ø³: ÙƒÙ… Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù„Ø§Ø²Ù… Ù„Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ø³ØªÙØ³Ø§Ø±Ø§ØªÙŠØŸ**
Ø¬: Ø¹Ø§Ø¯Ø©Ù‹ Ù†Ø±Ø¯ Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø©.

**Ø³: Ù‡Ù„ ÙŠÙ…ÙƒÙ†Ù†ÙŠ ØªØªØ¨Ø¹ Ø­Ø§Ù„Ø© Ø·Ù„Ø¨ÙŠØŸ**
Ø¬: Ù†Ø¹Ù…ØŒ Ø³Ù†Ø±Ø³Ù„ Ù„Ùƒ Ø±Ù‚Ù… ØªØªØ¨Ø¹ Ø¹Ù†Ø¯ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø·Ù„Ø¨Ùƒ.

**Ø³: Ù‡Ù„ Ù‡Ù†Ø§Ùƒ Ø±Ø³ÙˆÙ… Ø¥Ø¶Ø§ÙÙŠØ©ØŸ**
Ø¬: Ù„Ø§ØŒ Ø¬Ù…ÙŠØ¹ Ø®Ø¯Ù…Ø§ØªÙ†Ø§ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù…Ø¬Ø§Ù†ÙŠØ©.

---
"""
    
    keyboard = [
        [InlineKeyboardButton("â¬…ï¸ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", callback_data='back_to_menu')],
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    await query.edit_message_text(text=faq_text, reply_markup=reply_markup, parse_mode='Markdown')


async def handle_support(query, context: ContextTypes.DEFAULT_TYPE) -> None:
    """Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø·Ù„Ø¨ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù…"""
    support_text = """
ğŸ“ **Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ ÙØ±ÙŠÙ‚ Ø§Ù„Ø¯Ø¹Ù…**

ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©:
"""
    
    keyboard = [
        [InlineKeyboardButton("ğŸ”§ Ù…Ø´ÙƒÙ„Ø© ØªÙ‚Ù†ÙŠØ©", callback_data='tech_issue')],
        [InlineKeyboardButton("ğŸ’³ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø¯ÙØ¹", callback_data='payment_issue')],
        [InlineKeyboardButton("ğŸ“¦ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø·Ù„Ø¨", callback_data='order_issue')],
        [InlineKeyboardButton("â“ Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ø§Ù…", callback_data='general_inquiry')],
        [InlineKeyboardButton("â¬…ï¸ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", callback_data='back_to_menu')],
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    await query.edit_message_text(text=support_text, reply_markup=reply_markup, parse_mode='Markdown')


async def handle_about(query) -> None:
    """Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø·Ù„Ø¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù†Ø§"""
    about_text = """
â„¹ï¸ **Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù†Ø§**

ğŸ¢ **Ø§Ø³Ù… Ø§Ù„Ø´Ø±ÙƒØ©:** Ø´Ø±ÙƒØ© Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ù…Ù…ØªØ§Ø²Ø©

ğŸ“ **Ø§Ù„Ù…ÙˆÙ‚Ø¹:** Ø§Ù„Ø±ÙŠØ§Ø¶ØŒ Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©

ğŸ“§ **Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:** support@company.com

ğŸ“± **Ø§Ù„Ù‡Ø§ØªÙ:** +966 11 1234567

ğŸŒ **Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:** www.company.com

â° **Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„:** 
- Ø§Ù„Ø£Ø­Ø¯ - Ø§Ù„Ø®Ù…ÙŠØ³: 9 ØµØ¨Ø§Ø­Ø§Ù‹ - 6 Ù…Ø³Ø§Ø¡Ù‹
- Ø§Ù„Ø¬Ù…Ø¹Ø© ÙˆØ§Ù„Ø³Ø¨Øª: Ù…ØºÙ„Ù‚

---
"""
    
    keyboard = [
        [InlineKeyboardButton("â¬…ï¸ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", callback_data='back_to_menu')],
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    await query.edit_message_text(text=about_text, reply_markup=reply_markup, parse_mode='Markdown')


async def handle_complaint(query, context: ContextTypes.DEFAULT_TYPE) -> None:
    """Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ ÙˆØ§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª"""
    complaint_text = """
ğŸ’¬ **Ø´ÙƒÙˆÙ‰ Ø£Ùˆ Ø§Ù‚ØªØ±Ø§Ø­**

Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ùƒ! ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ø´ÙƒÙˆØ§Ùƒ Ø£Ùˆ Ø§Ù‚ØªØ±Ø§Ø­Ùƒ ÙÙŠ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©.

Ø³ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„ØªÙƒ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ù„Ù‰ ÙØ±ÙŠÙ‚ Ø§Ù„Ø¯Ø¹Ù….
"""
    
    keyboard = [
        [InlineKeyboardButton("âœï¸ Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ", callback_data='write_message')],
        [InlineKeyboardButton("â¬…ï¸ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©", callback_data='back_to_menu')],
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    await query.edit_message_text(text=complaint_text, reply_markup=reply_markup, parse_mode='Markdown')


async def back_to_menu(query) -> int:
    """Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"""
    welcome_text = """
ğŸ‘‹ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©

Ø§Ø®ØªØ± Ø£Ø­Ø¯ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©:
"""
    
    keyboard = [
        [InlineKeyboardButton("â“ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©", callback_data='faq')],
        [InlineKeyboardButton("ğŸ“ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù…", callback_data='support')],
        [InlineKeyboardButton("â„¹ï¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù†Ø§", callback_data='about')],
        [InlineKeyboardButton("ğŸ’¬ Ø´ÙƒÙˆÙ‰ Ø£Ùˆ Ø§Ù‚ØªØ±Ø§Ø­", callback_data='complaint')],
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    
    await query.edit_message_text(text=welcome_text, reply_markup=reply_markup)
    return CHOOSING


async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù†ØµÙŠØ©"""
    user_id = update.effective_user.id
    message_text = update.message.text
    
    # ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    if user_id in user_data:
        user_data[user_id]['messages'].append({
            'text': message_text,
            'timestamp': datetime.now()
        })
    
    # Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯
    confirmation_text = """
âœ… **ØªÙ… Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø±Ø³Ø§Ù„ØªÙƒ**

Ø´ÙƒØ±Ø§Ù‹ Ø¹Ù„Ù‰ ØªÙˆØ§ØµÙ„Ùƒ Ù…Ø¹Ù†Ø§! Ø³ÙŠØªÙ… Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙƒ ÙÙŠ Ø£Ù‚Ø±Ø¨ ÙˆÙ‚Øª Ù…Ù…ÙƒÙ†.

Ø±Ù‚Ù… ØªØªØ¨Ø¹ Ø·Ù„Ø¨Ùƒ: `#{}` 

ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø±Ù‚Ù… Ø§Ù„ØªØªØ¨Ø¹ Ù‡Ø°Ø§ Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©.
""".format(user_id)
    
    await update.message.reply_text(confirmation_text, parse_mode='Markdown')
    
    # Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„ (Ø¥Ø°Ø§ ØªÙ… ØªØ¹ÙŠÙŠÙ†Ù‡)
    if ADMIN_ID:
        admin_notification = f"""
ğŸ“¬ **Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„**

ğŸ‘¤ **Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:** {update.effective_user.first_name} (@{update.effective_user.username})
ğŸ†” **Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:** {user_id}
ğŸ’¬ **Ø§Ù„Ø±Ø³Ø§Ù„Ø©:** {message_text}
â° **Ø§Ù„ÙˆÙ‚Øª:** {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}
"""
        try:
            await context.bot.send_message(chat_id=ADMIN_ID, text=admin_notification, parse_mode='Markdown')
        except Exception as e:
            logger.error(f"Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ù„Ù„Ù…Ø³Ø¤ÙˆÙ„: {e}")


async def help_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """Ø£Ù…Ø± Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø©"""
    help_text = """
ğŸ†˜ **Ø£ÙˆØ§Ù…Ø± Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ù…ØªØ§Ø­Ø©:**

/start - Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© ÙˆØ§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
/help - Ø¹Ø±Ø¶ Ù‡Ø°Ù‡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
/status - Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø¯Ù…Ø©

---

**Ù…Ù„Ø§Ø­Ø¸Ø©:** ÙŠÙ…ÙƒÙ†Ùƒ Ø£ÙŠØ¶Ø§Ù‹ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ© ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù„ØªÙ†Ù‚Ù„ Ø¨Ø³Ù‡ÙˆÙ„Ø©.
"""
    await update.message.reply_text(help_text, parse_mode='Markdown')


async def status_command(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """Ø£Ù…Ø± Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø¯Ù…Ø©"""
    status_text = """
âœ… **Ø­Ø§Ù„Ø© Ø§Ù„Ø®Ø¯Ù…Ø©**

ğŸŸ¢ **Ø§Ù„Ø®Ø§Ø¯Ù…:** ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ
ğŸŸ¢ **Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:** Ù…ØªØµÙ„Ø©
ğŸŸ¢ **Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ:** Ù…ØªØ§Ø­

---

**Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:**
- Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†: {}
- Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„Ø© Ø§Ù„ÙŠÙˆÙ…: {}

Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ùƒ Ø®Ø¯Ù…Ø§ØªÙ†Ø§!
""".format(len(user_data), sum(len(u.get('messages', [])) for u in user_data.values()))
    
    await update.message.reply_text(status_text, parse_mode='Markdown')


async def error_handler(update: Update, context: ContextTypes.DEFAULT_TYPE) -> None:
    """Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡"""
    logger.error(msg="Ø­Ø¯Ø« Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ«:", exc_info=context.error)
    
    if update and update.effective_message:
        await update.effective_message.reply_text(
            "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ù…Ø§. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹ Ø£Ùˆ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ ÙØ±ÙŠÙ‚ Ø§Ù„Ø¯Ø¹Ù…."
        )


def main() -> None:
    """Ø¨Ø¯Ø¡ Ø§Ù„Ø¨ÙˆØª"""
    # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    application = Application.builder().token(BOT_TOKEN).build()
    
    # Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù„Ø¬Ø§Øª Ø§Ù„Ø£ÙˆØ§Ù…Ø±
    application.add_handler(CommandHandler("start", start))
    application.add_handler(CommandHandler("help", help_command))
    application.add_handler(CommandHandler("status", status_command))
    
    # Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù„Ø¬ Ù†Ù‚Ø±Ø§Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    application.add_handler(CallbackQueryHandler(button_callback))
    
    # Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù†ØµÙŠØ©
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))
    
    # Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù„Ø¬ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡
    application.add_error_handler(error_handler)
    
    # Ø¨Ø¯Ø¡ Ø§Ù„Ø¨ÙˆØª
    logger.info("ğŸš€ Ø¬Ø§Ø±ÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ø¨ÙˆØª...")
    application.run_polling(allowed_updates=Update.ALL_TYPES)


if __name__ == '__main__':
    main()

